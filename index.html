<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <!-- <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.8/css/bootstrap.min.css"
      integrity="sha512-2bBQCjcnw658Lho4nlXJcc6WkV/UxpE/sAokbXPxQNGqmNdQrWqtw26Ns9kFF/yG792pKR1Sx8/Y1Lf1XN4GKA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    /> -->

    <script src="js/axios.min.js"></script>

    <style>
      .ellipsis {
        white-space: nowrap; /* 줄바꿈 없이 한 줄로 유지 */
        overflow: hidden; /* 넘치는 부분 숨김 */
        text-overflow: ellipsis; /* 넘친 텍스트를 ...(ellipsis:생략 부호)으로 표시 */
      }

      ul,
      li {
        list-style: none;
        padding: 0;
      }

      a {
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h4 class="py-2" style="text-align: center">다음 검색</h4>
      <form class="d-flex gap-2 py-2" id="searchform" onsubmit="Search(event);">
        <input
          id="searchtext"
          type="text"
          class="form-control"
          placeholder="enter a keyword"
          value="손흥민"
        />
        <button
          class="btn btn-secondary"
          style="width: 5rem"
          onclick="Search(event);"
        >
          검색
        </button>
      </form>

      <div class="row">
        <ul id="searchResult" class="list-group">
          <!-- <li class="list-group-item list-group-item-action">
            <h4>
              <a href="" target="_blank" class="nav-link"
                >소하1동 새마을지도자협의회·부녀회, ‘탄소중립 실천 캠페인’
                실시</a
              >
            </h4>
            <p>
              11일 소하1동 행정복지센터와 한내천 공원 일대에서 ‘탄소중립 실천
              캠페인’을 진행했다. 이날 캠페인에는 회원 20여명이 참여해
              주민들에게 생활 속 탄소중립의 필요성과 실천 방법을 알리고 참여를
              독려했다...
            </p>
            <small class="text-muted">2023.09.28</small>
          </li> -->
        </ul>
      </div>
    </div>

    <script>
      const searchtextElm = document.getElementById("searchtext");
      const resultElm = document.getElementById("searchResult");

      function getDateTimeStr(dateStr) {
        const date = new Date(dateStr);
        const yyyy = date.getFullYear();
        const mm = String(date.getMonth() + 1).padStart(2, "0"); // 월은 0부터 시작
        const dd = String(date.getDate()).padStart(2, "0");
        const hh = String(date.getHours()).padStart(2, "0");
        const min = String(date.getMinutes()).padStart(2, "0");
        const ss = String(date.getSeconds()).padStart(2, "0");

        return `${yyyy}-${mm}-${dd} ${hh}:${min}:${ss}`;
      }
      function getDateStr(dateStr) {
        return dateStr.slice(0, 10) + " " + dateStr.slice(11, 19);
        // const date = new Date(dateStr);
        // const yyyy = date.getFullYear();
        // const mm = String(date.getMonth() + 1).padStart(2, "0"); // 월은 0부터 시작
        // const dd = String(date.getDate()).padStart(2, "0");

        // return `${yyyy}-${mm}-${dd}`;
      }

      function getSearchRow(item) {
        return `<li class="list-group-item list-group-item-action mb-3 border-top rounded-2">
                  <h5 class="fw-bold text-dark">
                    <a href="${
                      item.url
                    }" target="_blank" class="nav-link ellipsis" title="${
          item.title
        }">${item.title}</a></h5>
                  <p>
                    <a href="${
                      item.url
                    }" target="_blank" class="nav-link text-dark">${
          item.contents
        }</a>
                  </p>
                  <p class="text-end small mb-0">
                    ${getDateStr(item.datetime)}
                  </p>
            </li>`;
        // Bootstrap은 <p> 태그에 기본적으로 아래쪽 마진을 설정.
        // mb-0 추가하여 아래쪽 마진을 제거
      }

      function Search(e) {
        if (e) e.preventDefault(); // 기본 제출 동작 막기

        const txt = searchtextElm.value;
        console.log(txt);

        getkakaosearch(txt).then((dt) => {
          const docs = dt.documents;
          console.log(dt);
          let str = "";
          docs.forEach((item) => {
            str += getSearchRow(item);
          });
          resultElm.innerHTML = str;
        });
        return false;
      }

      async function getkakaosearch(qr) {
        try {
          const res = await axios.get("https://dapi.kakao.com/v2/search/web", {
            headers: {
              Authorization: "KakaoAK cafd059ab750c375164a71a01c72c9a2",
            },
            params: { query: qr, size: 10 },
          });

          const dt = res.data;
          return dt;
        } catch (error) {}
      }
    </script>
  </body>
</html>
